/*! CodeExcerise 02-11-2015 */
"use strict";!function(){angular.module("App",["ui.router","ngTable","ngAnimate","ngMessages","ngMaterial","oitozero.ngSweetAlert","toastr"]).run([function(){}]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$mdThemingProvider",function(a,b,c,d){return d.theme("default"),b.rule(function(a,b){var c=b.path(),d=c.toLowerCase();c!=d&&b.replace().path(d)}),c.html5Mode(!0).hashPrefix("!"),b.otherwise("/"),a.state("home",{url:"/",templateUrl:"partials/Dash/dashboard.html",controller:"DashCtrl"}).state("createSupplier",{url:"/supplier/create",templateUrl:"partials/Suppliers/Suppliers.html",controller:"SupplierCtrl"}).state("editSupplier",{url:"/supplier/edit/:id",templateUrl:"partials/Suppliers/Suppliers.html",controller:"SupplierCtrl"}).state("createProduct",{url:"/product/create",templateUrl:"partials/Products/Products.html",controller:"ProductCtrl"}).state("editProduct",{url:"/product/edit/:id",templateUrl:"partials/Products/Products.html",controller:"ProductCtrl"})}])}(),function(){angular.module("App").controller("DashCtrl",["$scope","$state","ngTableParams","suppliersManager","productsManager","SweetAlert","toastr","$filter",function(a,b,c,d,e,f,g,h){a.loading=!1,a.showProducts=!1,a.sSearch="",a.pSearch="",a.supplier=null,a.suppliers=[],a.products=[],a.filterProducts=[],a.supplierTable=new c({page:1,count:5,sorting:{SupplierID:"asc"}},{counts:[],total:a.suppliers.length,getData:function(b,c){var d=c.filter()?h("filter")(a.suppliers,c.filter()):a.suppliers;d=c.sorting()?h("orderBy")(d,c.orderBy()):d;var e=d.splice((c.page()-1)*c.count(),c.count());b.resolve(e)}}),a.productTable=new c({page:1,count:5,sorting:{ProductID:"asc"}},{counts:[],total:a.filterProducts.length,getData:function(b,c){var d=c.filter()?h("filter")(a.filterProducts,c.filter()):a.filterProducts;d=c.sorting()?h("orderBy")(d,c.orderBy()):d;var e=d.splice((c.page()-1)*c.count(),c.count());b.resolve(e)}}),a.loadSuppliers=function(){a.loading=!0,d.loadAllSuppliers().then(function(b){b&&500!=b?(a.suppliers=b,a.supplierTable.total(a.suppliers.length),a.supplierTable.reload(),a.supplierTable.page(1)):g.info("Could Not Load Suppliers"),a.loading=!1},function(){g.info("Error Occurred Loading Suppliers"),a.loading=!1})},a.loadProducts=function(){e.loadAllProducts().then(function(b){b&&500!=b?(a.products=b,a.filterProducts=b,a.productTable.total(a.products.length),a.productTable.reload(),a.productTable.page(1)):g.info("Could Not Load Products")},function(){g.info("Error Occurred Loading Products")})},a.deleteSupplier=function(b){f.swal({title:"Really Delete "+b.CompanyName+"?",text:"All associated products and order details will also be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No"},function(c){c&&b["delete"]().then(function(c){if(c){g.success("Supplier Deleted");var d=a.suppliers.indexOf(b);a.suppliers.splice(d,1),a.supplierTable.total(a.suppliers.length),a.supplierTable.reload()}else g.info("Could Not Delete Supplier")},function(){g.error("Error Occurred Deleting Supplier")})})},a.deleteProduct=function(b){f.swal({title:"Really Delete "+b.ProductName+"?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No"},function(c){c&&b["delete"]().then(function(c){if(c){g.success("Product Deleted");var d=a.products.indexOf(b);a.products.splice(d,1);var e=a.filterProducts.indexOf(b);a.filterProducts.splice(e,1),a.productTable.total(a.filterProducts.length),a.productTable.reload()}else g.info("Could Not Delete Product")},function(){g.error("Error Occurred Deleting Product")})})},a.editSupplier=function(a){b.go("editSupplier",{id:a.SupplierID})},a.editProduct=function(a){b.go("editProduct",{id:a.ProductID})},a.showSupplierProducts=function(b){var c=a.products;a.supplier=b,a.showProducts=!0,a.filterProducts=[];for(var d=0;d<c.length;d++)c[d].SupplierID==b.SupplierID&&a.filterProducts.push(c[d]);a.productTable.total(a.filterProducts.length),a.productTable.reload()},a.show=function(){a.showProducts=!0,a.supplier=null,a.filterProducts=a.products,a.productTable.total(a.filterProducts.length),a.productTable.reload()},a.back=function(){a.showProducts=!1},a.createSupplier=function(){b.go("createSupplier")},a.createProduct=function(){b.go("createProduct")},a.loadSuppliers(),a.loadProducts()}])}(),function(){angular.module("App").controller("ProductCtrl",["$scope","$state","productsManager","Product","suppliersManager","ProductService","SweetAlert","toastr",function(a,b,c,d,e,f,g,h){a.product=new d,a.suppliers=[],a.load=function(){e.loadAllSuppliers().then(function(d){d&&!d.error?a.suppliers=d:h.info("Could Not Load Suppliers");var e=f.getProduct();if(e&&e.ProductID>0)a.product=e;else{var g=b.params.id;g&&c.getProduct(g).then(function(c){c&&!c.error?a.product=c:(h.info("Product Does Not Exist"),b.go("home"))},function(){h.info("Error Occurred Loading Product")})}},function(){h.info("Error Occurred Loading Suppliers")})},a.create=function(){a.validateProduct()&&a.product.create().then(function(c){console.log(c),c&&!c.error?(h.success("Product Created"),a.product=new d(c[0]),b.go("editProduct",{id:c[0].ProductID})):h.info("Could Not Create Product")},function(){h.error("Error Occurred Creating Product")})},a.edit=function(){a.validateProduct()&&a.product.edit().then(function(a){a&&!a.error?(h.success("Product Updated"),b.go("home")):h.info("Could Not Update Product")},function(){h.error("Error Occurred Updating Product")})},a["delete"]=function(){g.swal({title:"Really Delete "+a.product.ProductName+"?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No"},function(c){c&&a.product["delete"]().then(function(a){a&&!a.error?(h.success("Product Deleted"),b.go("home")):h.info("Could Not Delete Product")},function(){h.error("Error Occurred Deleting Product")})})},a.cancel=function(){b.go("home")},a.validateProduct=function(){var b=a.product;return b.SupplierID?b.ProductName?b.ProductName.length>40?(a.ProductForm.ProductName.$error={required:!0},!1):!0:(a.ProductForm.ProductName.$error={required:!0},!1):(a.ProductForm.SupplierID.$error={required:!0},!1)},a.load()}])}(),function(){angular.module("App").controller("SupplierCtrl",["$scope","$state","suppliersManager","Supplier","SupplierService","SweetAlert","toastr",function(a,b,c,d,e,f,g){a.supplier=new d,a.load=function(){var d=e.getSupplier();if(d&&d.SupplierID>0)a.supplier=d;else{var f=b.params.id;f&&c.getSupplier(f).then(function(c){c&&!c.error?a.supplier=c:(g.info("Supplier Does Not Exist"),b.go("home"))},function(){g.info("Error Occurred Loading Supplier")})}},a.create=function(){a.validateSupplier()&&a.supplier.create().then(function(c){c&&!c.error?(g.success("Supplier Created"),a.supplier=new d(c[0]),b.go("editSupplier",{id:c[0].SupplierID})):g.info("Could Not Create Supplier")},function(){g.error("Error Occurred Creating Supplier")})},a.edit=function(){a.validateSupplier()&&a.supplier.edit().then(function(a){a&&!a.error?(g.success("Supplier Updated"),b.go("home")):g.info("Could Not Update Supplier")},function(){g.error("Error Occurred Updating Supplier")})},a["delete"]=function(){f.swal({title:"Really Delete "+a.supplier.CompanyName+"?",text:"All associated products and order details will also be deleted",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No"},function(c){c&&a.supplier["delete"]().then(function(a){a&&!a.error?(g.success("Supplier Deleted"),b.go("home")):g.info("Could Not Delete Supplier")},function(){g.error("Error Occurred Deleting Supplier")})})},a.cancel=function(){b.go("home")},a.validateSupplier=function(){var b=a.supplier.CompanyName;return b?b.length>40?!1:!0:!1},a.load()}])}(),function(){angular.module("App").factory("Product",["$http","$rootScope","$q",function(a,b,c){function d(a){a&&this.setData(a)}return d.prototype={ProductName:"",ProductID:0,SupplierID:0,setData:function(a){angular.extend(this,a)},create:function(){var b=c.defer();return a.post("/api/products/",this).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){console.log(a,c,d,e),b.reject()}),b.promise},edit:function(){var b=c.defer();return a.put("/api/products/"+this.ProductID,this).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){console.log(a,c,d,e),b.reject()}),b.promise},"delete":function(){var b=c.defer();return a["delete"]("/api/products/"+this.ProductID).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){b.reject()}),b.promise}},d}])}(),function(){angular.module("App").factory("productsManager",["$http","$q","Product","$rootScope",function(a,b,c,d){var e={_pool:{},_retrieveInstance:function(a,b){var d=this._pool[a];return d?d.setData(b):(d=new c(b),this._pool[a]=d),d},_search:function(a){return this._pool[a]},_load:function(b,c){var d=this;a.get("api/products/"+b).success(function(a){if(a.length){var b=d._retrieveInstance(a[0].ProductID,a[0]);c.resolve(b)}else c.resolve(null)}).error(function(){c.reject()})},getProduct:function(a){var c=b.defer(),d=this._search(a);return d?c.resolve(d):this._load(a,c),c.promise},loadAllProducts:function(){var c=b.defer(),d=this;return a.get("api/products/").success(function(a){var b=[];a.forEach(function(a,c,e,f){var g=d._retrieveInstance(a.ProductID,a);b.push(g)}),c.resolve(b)}).error(function(a,b,d,e){console.log(a,b,d,e),c.reject()}),c.promise},setProduct:function(a){var b=this,c=this._search(a.ProductID);return c?c.setData(a):c=b._retrieveInstance(a),c}};return e}])}(),function(){angular.module("App").factory("Supplier",["$http","$rootScope","$q",function(a,b,c){function d(a){a&&this.setData(a)}return d.prototype={CompanyName:"",SupplierID:0,setData:function(a){angular.extend(this,a)},create:function(){var b=c.defer();return a.post("api/suppliers/",this).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){console.log(a,c,d,e),b.reject()}),b.promise},edit:function(){var b=c.defer();return a.put("api/suppliers/"+this.SupplierID,this).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){console.log(a,c,d,e),b.reject()}),b.promise},"delete":function(){var b=c.defer();return a["delete"]("api/suppliers/"+this.SupplierID).success(function(a,c,d,e){b.resolve(a)}).error(function(a,c,d,e){b.reject()}),b.promise}},d}])}(),function(){angular.module("App").factory("suppliersManager",["$http","$q","Supplier","$rootScope",function(a,b,c,d){var e={_pool:{},_retrieveInstance:function(a,b){var d=this._pool[a];return d?d.setData(b):(d=new c(b),this._pool[a]=d),d},_search:function(a){return this._pool[a]},_load:function(b,c){var d=this;a.get("api/suppliers/"+b).success(function(a){if(a.length){var b=d._retrieveInstance(a[0].SupplierID,a[0]);c.resolve(b)}else c.resolve(null)}).error(function(){c.reject()})},getSupplier:function(a){var c=b.defer(),d=this._search(a);return d?c.resolve(d):this._load(a,c),c.promise},loadAllSuppliers:function(){var c=b.defer(),d=this;return a.get("api/suppliers/").success(function(a){var b=[];a.forEach(function(a,c,e,f){var g=d._retrieveInstance(a.SupplierID,a);b.push(g)}),c.resolve(b)}).error(function(a,b,d,e){console.log(a,b,d,e),c.reject()}),c.promise},setSupplier:function(a){var b=this,c=this._search(a.SupplierID);return c?c.setData(a):c=b._retrieveInstance(a),c}};return e}])}(),angular.module("App").service("ProductService",["Product",function(a){this.product=new a,this.getProduct=function(){return this.product},this.setProduct=function(a){this.product=a}}]),angular.module("App").service("SupplierService",["Supplier",function(a){this.supplier=new a,this.getSupplier=function(){return this.supplier},this.setSupplier=function(a){this.supplier=a}}]);